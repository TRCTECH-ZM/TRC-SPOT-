<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TRCexercise | 4D Fitness Universe</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        :root {
            --primary: #00f2fe;
            --secondary: #4facfe;
            --accent: #f093fb;
            --dark: #050505;
            --glass: rgba(255, 255, 255, 0.08);
            --text: #ffffff;
        }

        body, html {
            margin: 0; padding: 0;
            font-family: 'Segoe UI', system-ui, sans-serif;
            background-color: var(--dark);
            color: var(--text);
            overflow-x: hidden;
            scroll-behavior: smooth;
        }

        #bg-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }

        header {
            position: fixed; width: 100%; top: 0;
            background: rgba(0,0,0,0.9);
            backdrop-filter: blur(15px);
            z-index: 1000;
            padding: 10px 20px;
            display: flex; flex-direction: column; align-items: center;
            border-bottom: 2px solid var(--primary);
            box-sizing: border-box;
        }

        .header-top { width: 100%; display: flex; justify-content: space-between; align-items: center; max-width: 1000px; }
        .logo { font-size: 20px; font-weight: 900; letter-spacing: 3px; color: var(--primary); text-transform: uppercase; }
        .live-clock { font-family: 'Courier New', monospace; color: var(--accent); font-size: 14px; font-weight: bold; }

        .audio-hub { margin-top: 10px; display: flex; gap: 10px; align-items: center; flex-wrap: wrap; justify-content: center; }
        
        .container { width: 100%; max-width: 800px; margin: 0 auto; padding: 160px 15px 40px 15px; box-sizing: border-box; }

        .glass-card {
            background: var(--glass);
            backdrop-filter: blur(25px);
            border-radius: 25px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .timer-display { font-size: 3.5rem; text-align: center; color: var(--primary); font-family: 'Courier New', monospace; margin: 10px 0; text-shadow: 0 0 15px var(--primary); }

        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .full-width { grid-column: span 2; }

        label { font-size: 11px; color: var(--primary); text-transform: uppercase; letter-spacing: 1px; font-weight: bold; margin-bottom: 5px; }

        input, select {
            width: 100%; background: rgba(0,0,0,0.6); border: 1px solid rgba(0, 242, 254, 0.4);
            padding: 14px; border-radius: 12px; color: white; outline: none; box-sizing: border-box;
        }

        .btn {
            width: 100%; padding: 18px; border-radius: 15px; border: none; font-weight: 900;
            text-transform: uppercase; cursor: pointer; transition: 0.3s; margin-top: 10px;
        }

        .btn-primary { background: linear-gradient(45deg, var(--primary), var(--secondary)); color: black; }
        .btn-copy { background: var(--accent); color: black; font-size: 12px; padding: 12px; }
        .btn-audio { background: transparent; border: 1px solid var(--primary); color: var(--primary); padding: 5px 12px; font-size: 11px; border-radius: 20px; width: auto; margin: 0;}

        .plan-section { display: none; }
        .protocol-box { 
            background: rgba(0,0,0,0.4); padding: 20px; border-radius: 18px; 
            margin-top: 15px; border-left: 4px solid var(--accent); 
            font-size: 15px; line-height: 1.6; white-space: pre-wrap;
        }

        .custom-file-upload { border: 1px solid var(--accent); display: inline-block; padding: 5px 12px; cursor: pointer; border-radius: 20px; font-size: 11px; color: var(--accent); }

        @media (max-width: 480px) { .timer-display { font-size: 2.5rem; } .grid { grid-template-columns: 1fr; } .full-width { grid-column: span 1; } }
    </style>
</head>
<body>

    <canvas id="bg-canvas"></canvas>

    <header>
        <div class="header-top">
            <div class="logo">TRCexercise</div>
            <div class="live-clock" id="clock">00:00:00</div>
        </div>
        <div class="audio-hub">
            <button class="btn btn-audio" onclick="toggleDefaultMusic()" id="musicBtn">â™« Default Beats</button>
            <label class="custom-file-upload">
                <input type="file" id="userAudio" accept="audio/*" style="display:none;" onchange="handleUserMusic(event)">
                ðŸ“ Import Your Own Song
            </label>
            <audio id="bgMusic" loop><source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg"></audio>
            <audio id="userAudioPlayer" loop></audio>
        </div>
    </header>

    <div class="container">
        <!-- Part 1: Intensity Timer -->
        <div class="glass-card">
            <label style="text-align: center; display:block;">Workout Countdown</label>
            <div class="timer-display" id="timer">00:00</div>
            <div style="display: flex; gap: 10px;">
                <input type="number" id="tInput" placeholder="Secs">
                <button class="btn btn-primary" style="margin: 0; width: 40%;" onclick="startTimer()">START</button>
            </div>
            <button class="btn" style="background: transparent; color: #ff4757; border: 1px solid #ff4757; padding: 8px; font-size: 12px;" onclick="resetTimer()">Reset</button>
        </div>

        <!-- Part 2: AI User Data -->
        <div class="glass-card">
            <h2 style="text-align: center; margin-top: 0; color: var(--primary); font-size: 1.2rem; letter-spacing: 2px;">AI ARCHITECT</h2>
            <div class="grid">
                <div class="input-box"><label>Age</label><input type="number" id="age" placeholder="25"></div>
                <div class="input-box"><label>Weight (kg)</label><input type="number" id="weight" placeholder="70"></div>
                <div class="input-box full-width"><label>Height (cm)</label><input type="number" id="height" placeholder="175"></div>
                <div class="input-box full-width">
                    <label>Training Gear</label>
                    <select id="eq">
                        <option value="Bodyweight/No Equipment">Bodyweight / No Equipment</option>
                        <option value="Dumbbells Only">Dumbbells Only</option>
                        <option value="Full Professional Gym">Full Professional Gym</option>
                    </select>
                </div>
            </div>
            <button class="btn btn-primary" onclick="generateDualPlan()">Initialize AI Sequence</button>
        </div>

        <!-- Part 3: Result Display (Separated) -->
        <div id="plan-section" class="plan-section">
            <div class="glass-card">
                <h3 style="margin:0; color: var(--primary); text-align: center;">WORKOUT PROTOCOL</h3>
                <div id="workout-txt" class="protocol-box"></div>
                <button class="btn btn-copy" onclick="copyPlan('workout-txt')">ðŸ“‹ COPY WORKOUT</button>
                <a href="https://www.youtube.com/results?search_query=how+to+do+exercises" target="_blank" class="btn" style="background: #ff0000; color: white; text-align: center; text-decoration: none; display: block;">ðŸ“º WATCH WORKOUT VIDEOS</a>
            </div>

            <div class="glass-card">
                <h3 style="margin:0; color: var(--accent); text-align: center;">DIET PROTOCOL</h3>
                <div id="diet-txt" class="protocol-box" style="border-left-color: var(--primary);"></div>
                <button class="btn btn-copy" onclick="copyPlan('diet-txt')">ðŸ“‹ COPY DIET PLAN</button>
            </div>
        </div>
    </div>

    <script>
        // --- 3D ENVIRONMENT ---
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({canvas: document.getElementById('bg-canvas'), alpha: true, antialias: true});
        renderer.setSize(window.innerWidth, window.innerHeight);
        const dumbbell = new THREE.Group();
        const mat = new THREE.MeshPhongMaterial({color: 0x00f2fe, wireframe: true});
        const handle = new THREE.Mesh(new THREE.CylinderGeometry(0.12, 0.12, 3.5, 12), mat);
        handle.rotation.z = Math.PI/2;
        const p1 = new THREE.Mesh(new THREE.CylinderGeometry(0.9, 0.9, 0.6, 12), mat); p1.position.x = -1.4; p1.rotation.z = Math.PI/2;
        const p2 = new THREE.Mesh(new THREE.CylinderGeometry(0.9, 0.9, 0.6, 12), mat); p2.position.x = 1.4; p2.rotation.z = Math.PI/2;
        dumbbell.add(handle, p1, p2);
        scene.add(dumbbell);
        const light = new THREE.PointLight(0xffffff, 1, 100); light.position.set(5, 5, 5); scene.add(light, new THREE.AmbientLight(0x404040));
        camera.position.z = 6;
        function animate() { requestAnimationFrame(animate); dumbbell.rotation.y += 0.01; dumbbell.rotation.x += 0.005; renderer.render(scene, camera); }
        animate();

        // --- CLOCK ---
        setInterval(() => { document.getElementById('clock').innerText = new Date().toLocaleTimeString(); }, 1000);

        // --- AUDIO HUB LOGIC ---
        const bgMusic = document.getElementById('bgMusic');
        const userMusic = document.getElementById('userAudioPlayer');
        
        function toggleDefaultMusic() {
            userMusic.pause();
            if(bgMusic.paused) { bgMusic.play(); document.getElementById('musicBtn').innerText = "|| Pause Default"; }
            else { bgMusic.pause(); document.getElementById('musicBtn').innerText = "â™« Default Beats"; }
        }

        function handleUserMusic(event) {
            bgMusic.pause();
            document.getElementById('musicBtn').innerText = "â™« Default Beats";
            const file = event.target.files[0];
            if(file) {
                userMusic.src = URL.createObjectURL(file);
                userMusic.play();
                alert("Playing your custom track!");
            }
        }

        // --- TIMER & VOICE ---
        let timerInt;
        function startTimer() {
            clearInterval(timerInt);
            let s = parseInt(document.getElementById('tInput').value) || 0;
            timerInt = setInterval(() => {
                if(s <= 0) {
                    clearInterval(timerInt);
                    window.speechSynthesis.speak(new SpeechSynthesisUtterance("Complete"));
                    return;
                }
                s--;
                document.getElementById('timer').innerText = `${Math.floor(s/60).toString().padStart(2,'0')}:${(s%60).toString().padStart(2,'0')}`;
            }, 1000);
        }
        function resetTimer() { clearInterval(timerInt); document.getElementById('timer').innerText = "00:00"; }

        // --- AI EXECUTION ---
        async function generateDualPlan() {
            const age = document.getElementById('age').value;
            const weight = document.getElementById('weight').value;
            const eq = document.getElementById('eq').value;
            const section = document.getElementById('plan-section');
            
            if(!age || !weight) return alert("Missing stats!");

            section.style.display = 'block';
            document.getElementById('workout-txt').innerText = "Architecting Workout...";
            document.getElementById('diet-txt').innerText = "Calculating Macros...";
            window.scrollTo({top: section.offsetTop - 50, behavior: 'smooth'});

            const query = `Create a specific workout and a separate specific diet plan for: Age ${age}, Weight ${weight}kg, Equipment ${eq}. Format your answer with the word 'DIET_START' between the workout and the diet. No symbols.`;

            try {
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=TRCEXERCISE-ZM`, {
                    method: 'POST', headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({contents: [{parts: [{text: query}]}]})
                });
                const data = await res.json();
                const aiResponse = data.candidates[0].content.parts[0].text;
                
                const split = aiResponse.split('DIET_START');
                document.getElementById('workout-txt').innerText = split[0].replace(/\*/g, '').trim();
                document.getElementById('diet-txt').innerText = (split[1] || "AI suggests high protein for your profile.").replace(/\*/g, '').trim();
            } catch(e) {
                document.getElementById('workout-txt').innerText = "1. Pushups 3x15\n2. Squats 3x20\n3. Planks 3x60s";
                document.getElementById('diet-txt').innerText = "Breakfast: Eggs & Oats\nLunch: Chicken & Rice\nDinner: Fish & Greens";
            }
        }

        function copyPlan(id) {
            navigator.clipboard.writeText(document.getElementById(id).innerText);
            alert("Copied to clipboard!");
        }
    </script>
</body>
</html>